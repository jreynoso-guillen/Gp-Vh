<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">
        <h:head>           
            <f:facet name="first">
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
            </f:facet>
        </h:head>
        <h:body   >
            <ui:composition template="./Templates/vehiculosTemplate.xhtml">
                <ui:define name="Content">
                
            

                    <!-- *******************************TU CODIGO AQUI. NO MOVER LO DEMAS.******************************************** --> 
                    <br/>
                    <h:form id="mg">
                        <p:growl id="growl" showDetail="true" life="30000" />
                    </h:form>
                        <h:form id="formVh">
                            <p:commandButton id="btnEm" update=":formVh1" oncomplete="PF('tablaDialog').show()"  value="Nueva" actionListener="#{vehiculosBackBean.agregarNuevoVh}"/>
                            
                            <p:dataTable value="#{vehiculosBackBean.listaVh}" var="e" id="singleDT" emptyMessage="No hay registros para mostrar"
                                         selectionMode="single" selection="#{vehiculosBackBean.selected}" rowKey="#{e.id}"  widgetVar="dataTableWidgetVar" editable="true"
                                         rows="20" paginator="true" paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
                                         scrollable="true" scrollWidth="95%" style="font-size: 16px !important;"
                                         multiViewState="true" rowStyleClass="#{e.status eq true ? null:'red'}"
                                         >
                                <f:facet name="header">
                                    Vehiculos afiliados a Gps-Tracker
                                    <p:commandButton id="toggler" type="button" value="Columnas" style="float:right" icon="ui-icon-calculator" />
                                    <p:columnToggler datasource="singleDT" trigger="toggler" >
                                        <p:ajax event="toggle"  listener="#{vehiculosBackBean.onToggle}"/>
                                    </p:columnToggler>
                                </f:facet>
                                <p:column headerText="Id" width="30" visible="#{vehiculosBackBean.list[0]}">
                                    <f:facet name="header">
                                        <h:outputText value="Id" />
                                    </f:facet>
                                    <h:outputText value="#{e.id}"/>
                                </p:column>
                                <p:column headerText="Nombre" filterBy="#{e.nombre}" width="300" filterMatchMode="contains" visible="#{vehiculosBackBean.list[1]}" >
                                    <f:facet name="header">
                                        <h:outputText value="Nombre" />
                                    </f:facet>
                                    <h:outputText value="#{e.nombre}"/>
                                </p:column>
                                <p:column headerText="Fecha Alta"  width="250" visible="#{vehiculosBackBean.list[2]}">
                                    <h:outputText value="#{e.fechaAlta}">
                                        <f:convertDateTime pattern="dd-MM-yyyy " />
                                    </h:outputText>
                                    
                                </p:column>
                                <p:column headerText="Plataforma" width="200" visible="#{vehiculosBackBean.list[3]}">
                                    <h:outputText value="#{e.plataforma}"/>
                                </p:column>
                                <p:column headerText="IMEI" width="200" visible="#{vehiculosBackBean.list[4]}">
                                    <h:outputText value="#{e.IMEI}"/>
                                </p:column>
                                <p:column headerText="GPS Marca" width="200" visible="#{vehiculosBackBean.list[19]}">
                                    <h:outputText value="#{e.gpsMarca}"/>
                                </p:column>
                                <p:column headerText="No Telefonico" width="200" visible="#{vehiculosBackBean.list[5]}">
                                    <h:outputText value="#{e.numeroTelefono}"/>
                                </p:column>
                                <p:column headerText="Clave" width="200" visible="#{vehiculosBackBean.list[6]}">
                                    <h:outputText value="#{e.clave}"/>
                                </p:column>
                                <p:column headerText="Saldo" width="200" visible="#{vehiculosBackBean.list[7]}">
                                    <p:inputText value="#{e.saldo}"/>
                                </p:column>
                                <p:column headerText="Fecha Vencimiento" filterBy="#{e.fechaVenceS}" filterMatchMode="contains" width="250" visible="#{vehiculosBackBean.list[8]}">
                                    <p:calendar value="#{e.fechaVence}" pattern="dd-MM-yyyy" showOn="button" onchange="#{vehiculosBackBean.onDateSelected(e.fechaVence)}"/>
                                </p:column>
                                <p:column headerText="Tipo de cobro" width="200" visible="#{vehiculosBackBean.list[9]}">
                                    <h:outputText value="#{e.tipoCobro}"/>
                                </p:column>
                                <p:column headerText="Cuenta" width="200" visible="#{vehiculosBackBean.list[10]}">
                                    <h:outputText value="#{e.cuenta}"/>
                                </p:column>
                                <p:column headerText="Marca" width="200" visible="#{vehiculosBackBean.list[11]}">
                                    <h:outputText value="#{e.marca}"/>
                                </p:column>
                                <p:column headerText="Modelo" width="200" visible="#{vehiculosBackBean.list[12]}">
                                    <h:outputText value="#{e.modelo}"/>
                                </p:column>
                                <p:column headerText="Año" width="200" visible="#{vehiculosBackBean.list[13]}">
                                    <h:outputText value="#{e.an}"/>
                                </p:column>
                                <p:column headerText="Placa" width="200" visible="#{vehiculosBackBean.list[14]}">
                                    <h:outputText value="#{e.placa}"/>
                                </p:column>
                                <p:column headerText="Serie" width="200" visible="#{vehiculosBackBean.list[15]}">
                                    <h:outputText value="#{e.serie}"/>
                                </p:column>
                                
                                <p:column headerText="Motor" width="200" visible="#{vehiculosBackBean.list[16]}">
                                    <h:outputText value="#{e.motor}"/>
                                </p:column>
                                <p:column headerText="Activo" width="300" visible="#{vehiculosBackBean.list[17]}" filterBy="#{e.status}" filterMatchMode="equals" >
                                        <f:facet name="filter">
                                                <p:selectOneMenu onchange="PF('dataTableWidgetVar').filter()">
                                                    <f:converter converterId="javax.faces.Boolean" />
                                                    <f:selectItem itemLabel="Todos" itemValue="" />
                                                    <f:selectItem itemLabel="ACTIVO" itemValue="true" />
                                                    <f:selectItem itemLabel="DESHABILITADO" itemValue="false" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                    <p:selectOneMenu id="somActivo" value="#{e.status}">
                                        <p:ajax update="somActivo" listener="#{vehiculosBackBean.cambiaStatus(e.id, e.status)}"/>
                                        <f:selectItem itemLabel="ACTIVO" itemValue="true"/>
                                        <f:selectItem itemLabel="DESHABILITADO" itemValue="false"/>
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column headerText="Colaborador" visible="#{vehiculosBackBean.list[20]}" width="250">
                                    <h:outputText value="#{e.colaborador}"/>
                                </p:column>
                                <p:column headerText="Empresa" width="200" visible="#{vehiculosBackBean.list[18]}">
                                    <p:selectOneMenu id="somE" value="#{e.empresa}" >
                                        <f:selectItems  value="#{vehiculosBackBean.listaEmpresas}" var="vh" itemLabel="#{vh.nombre}" itemValue="#{vh.id}"/>
                                    </p:selectOneMenu>
                                </p:column>
                                         
                                <p:column  headerText="Pagado" width="200"  rendered="#{vehiculosBackBean.mostrarPagado}" visible="#{vehiculosBackBean.list[20]}">
                                   <p:selectOneMenu id="somPagado" value="#{e.pagado}">
                                       <p:ajax update="somPagado"/>
                                       <f:selectItem itemLabel="Pagado" itemValue="true"/>
                                       <f:selectItem itemLabel="Sin pagar" itemValue="false"/>
                                    </p:selectOneMenu>
                                </p:column>
                                         
                                <p:column headerText="Guardar" width="200" exportable="false" >
                                    <p:commandButton value="Guardar" oncomplete="PF('dataTableWidgetVar').clearFilters()" ajax="false">
                                        <p:ajax listener="#{vehiculosBackBean.modificaVh(e)}" />
                                    </p:commandButton>
                                </p:column>
                                
                            </p:dataTable>
                            <h:commandLink>
                                <p:graphicImage name="imagenes/excel.png" />
                                <p:dataExporter target="singleDT" type="xls" fileName="Vehiculos" pageOnly="false"/>
                            </h:commandLink>
                        </h:form>
                    
                    <p:dialog header="Datos del Vehiculo" widgetVar="tablaDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false" style="position: fixed !important;">
                        <h:form id="formVh1">
                            <p:panelGrid columns="2" style="border: 0px !important;">
                                <p:outputLabel value="Nombre vehiculo"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.nombre}" required="true"/>
                                
                                <p:outputLabel value="Fecha de Alta"/>
                                <p:calendar value="#{vehiculosBackBean.vhTemp.fechaAlta}" showOn="button" required="true"/>
                                
                                <p:outputLabel value="Plataforma"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.plataforma}" required="true"/>
                                
                                <p:outputLabel value="IMEI"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.IMEI}" required="true"/>
                                
                                <p:outputLabel value="GPS Marca"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.gpsMarca}" required="true"/>
                                
                                <p:outputLabel value="Numero telefonico"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.numeroTelefono}" required="true"/>
                                
                                <p:outputLabel value="Clave "/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.clave}" required="true"/>
                                
                                <p:outputLabel value="Saldo"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.saldo}" required="true"/>
                                
                                <p:outputLabel value="Fecha de vencimiento"/>
                                <p:calendar value="#{vehiculosBackBean.vhTemp.fechaVence}" showOn="button" required="true"/>
                                
                                <p:outputLabel value="Tipo de cobro"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.tipoCobro}" required="true"/>
                                
                                <p:outputLabel value="Cuenta"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.cuenta}" required="true"/>
                                
                                <p:outputLabel value="Marca"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.marca}" required="true"/>
                                
                                <p:outputLabel value="Modelo"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.modelo}" required="true"/>
                                
                                <p:outputLabel value="Año"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.an}" required="true"/>
                                
                                <p:outputLabel value="Placa"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.placa}" required="true"/>
                                
                                <p:outputLabel value="Serie"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.serie}" required="true"/>
                                
                                <p:outputLabel value="Motor"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.motor}" required="true"/>
                                
                                <p:outputLabel value="Colaborador"/>
                                <p:inputText value="#{vehiculosBackBean.vhTemp.colaborador}"/>
                                
                                <p:outputLabel value="Activo"/>
                                <p:selectBooleanCheckbox value="#{vehiculosBackBean.vhTemp.status}" /> 
                                
                                <p:outputLabel value="Empresa"/>
                                <p:selectOneMenu value="#{vehiculosBackBean.vhTemp.empresa}">
                                    <f:selectItems value="#{vehiculosBackBean.listaEmpresas}" var="empresa" itemLabel="#{empresa.nombre}" itemValue="#{empresa.id}"/>
                                </p:selectOneMenu>
                                
                            </p:panelGrid>
                            <p:commandButton value="Agregar" actionListener="#{vehiculosBackBean.guardaVh}" oncomplete="PF('tablaDialog').hide()" update="mg:growl,:formVh"/>
                        </h:form>
                    </p:dialog>
                    
                    
                    <p:dialog header="Datos de la empresa" widgetVar="tablaDialog2" modal="true" showEffect="fade" hideEffect="fade" resizable="false" style="position: fixed !important;">
                        <h:form id="formVh2">
                            
                        </h:form>
                    </p:dialog>
                    <!-- ************************************************************************************************************* --> 
            
                </ui:define>
            </ui:composition>    
        </h:body>
    </f:view>
</html>

